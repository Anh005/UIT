--TRIGGER 1
CREATE TRIGGER TRIG1
ON CTHD
FOR INSERT
AS
BEGIN
	--Cap nhat sl trong kho
	UPDATE KHOHANG
	SET SL = SL - INSERTED.SL
	FROM KHOHANG, INSERTED
	WHERE KHOHANG.MSSP = INSERTED.MSSP

END


--TRIGGER 2
CREATE TRIGGER TRIG2
ON KHOHANG
FOR UPDATE
AS
BEGIN
	--Them vao bang nhat ky chi trong 1 so truong hop nhat dinh
	--TH: chi khi so luong san pham duoi 50
	INSERT INTO NHATKYKIEMTOANHANG (MSSP, SLCU, SLMOI, NGAYCAPNHAT)
	SELECT
		DELETED.MSSP, DELETED.SL, INSERTED.SL, GETDATE();
	FROM INSERTED, DELETED
	WHERE INSERTED.MSSP = DELETED.MSSP
	AND INSERTED.SL < 50 AND DELETED.SL >= 50
			
END